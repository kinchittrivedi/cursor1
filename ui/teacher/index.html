<!doctype html>
<html>
<head>
	<meta charset="utf-8" />
	<title>Teacher Dashboard</title>
	<style>
		body{font-family:sans-serif;max-width:900px;margin:20px auto}
		.card{border:1px solid #ddd;border-radius:8px;padding:16px;margin:8px 0}
		table{border-collapse:collapse;width:100%}
		td,th{border:1px solid #ddd;padding:8px}
	</style>
</head>
<body>
	<h2>Teacher Dashboard</h2>
	<div class="card">
		<h3>Upload Class 8 Science PDF</h3>
		<input type="file" id="pdf" accept="application/pdf" />
		<button onclick="uploadPdf()">Upload</button>
		<pre id="uploadResult"></pre>
	</div>
	<div class="card">
		<h3>Leaderboard</h3>
		<table id="lb"><thead><tr><th>Rank</th><th>Name</th><th>XP</th></tr></thead><tbody></tbody></table>
	</div>
	<div class="card">
		<h3>Mastery by Concept (enter student id)</h3>
		<input id="sid" placeholder="1"/>
		<button onclick="loadMastery()">Load</button>
		<table id="ms"><thead><tr><th>Chapter</th><th>Skill</th><th>Mastery</th></tr></thead><tbody></tbody></table>
	</div>
<script>
async function uploadPdf(){
	const f=document.getElementById('pdf').files[0]
	if(!f){document.getElementById('uploadResult').innerText='Choose a PDF first';return}
	const form=new FormData()
	form.append('file',f)
	const res=await fetch('/api/upload/pdf',{method:'POST',body:form})
	const data=await res.json()
	document.getElementById('uploadResult').innerText=JSON.stringify(data,null,2)
}
async function loadLeaderboard(){
	const res=await fetch('/api/teacher/leaderboard')
	const data=await res.json()
	const tbody=document.querySelector('#lb tbody')
	tbody.innerHTML=data.map((r,i)=>`<tr><td>${i+1}</td><td>${r.name}</td><td>${r.xp}</td></tr>`).join('')
}
async function loadMastery(){
	const id=document.getElementById('sid').value
	const res=await fetch('/api/teacher/mastery/'+id)
	const data=await res.json()
	const tbody=document.querySelector('#ms tbody')
	tbody.innerHTML=data.map(r=>`<tr><td>${r.chapter_id}</td><td>${r.skill_id}</td><td>${(r.mastery*100).toFixed(0)}%</td></tr>`).join('')
}
loadLeaderboard()
</script>
</body>
</html>